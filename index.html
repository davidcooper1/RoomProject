<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Dream House</title>
        <script src="libs/aframe.min.js"></script>
        <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v1.14.0/dist/aframe-extras.min.js"></script>
        <script>
            AFRAME.registerComponent("toggle-lighting", {
                init: function() {
                    var state = true;
                    console.log("Component registered.");
                    console.log(this.el);
                    this.el.addEventListener("click", function(evt) {
                        var newIntensity;
                        if (state) {
                            newIntensity = 0;
                            state = false;
                        } else {
                            newIntensity = 0.75;
                            state = true;
                        }

                        document.querySelector("#MainLighting").setAttribute("light", {intensity: newIntensity}, false);
                    });
                }
            });

            AFRAME.registerComponent("tv-screen", {
                init: function() {
                    var on = false;
                    var self = this.el;
                    this.el.addEventListener("click", function(evt) {
                        var newMaterial;
                        var newLighting;
                        if (on) {
                            newMaterial = {shader: "standard", color : "black"};
                            newLighting = {intensity: "0"};
                            on = false;
                        } else {
                            newMaterial = {shader: "flat", src: "#pokemon"};
                            newLighting = {type: "point", intensity: "0.3", distance: "10"};
                            on = true;
                        }
                        self.setAttribute("material", newMaterial, true);
                        self.setAttribute("light", newLighting, false);
                    });
                }
            })
        </script>
    </head>
    <body>
        <a-scene light="defaultLightsEnabled: false" shadow="type=pcfsoft">
            <a-entity light="type: ambient; intensity: 0.1"></a-entity>

            <a-assets>
                <a-asset-item id="tv" src="assets/led_tv.gltf"/>
                <a-asset-item id="sofa" src="assets/sofa.gltf"/>
                <video id="pokemon" src="vids/pokemon.mp4" autoplay="true" loop="true" muted="true"/>
            </a-assets>

            <a-sky color="#ECECEC"></a-sky>
            <a-entity position="0 0 0">
                <a-camera universal-controls>
                    <a-entity raycaster="far: 150; objects: .intersectable" cursor geometry="primitive: ring; radiusOuter: 0.015;
                              radiusInner: 0.01; segmentsTheta: 32" material="color: #283644; shader: flat" position="0 0 -0.75"></a-entity>
                </a-camera>
            </a-entity>

            <!-- Lighting -->
            <a-entity id="MainLighting" geometry="primitive:box; depth:1; height:1; width: 1" material="shader:flat" light="type: point; intensity: 0.75; distance: 50" position="0 9 0"></a-entity>

            <a-entity toggle-lighting class="intersectable" geometry="primitive:box; depth: 1; height: 1; width: 1" material="shader:flat; color: blue" position="0 1 0"></a-entity>
            <!--Floor -->
            <a-entity geometry="primitive:box; depth: 20; height:0.1; width: 30" position="0 0 0" material="src: url(images/carpet.jpg); repeat: 30 20; metalness: 0; roughness: 1"></a-entity>

            <!--Ceiling -->
            <a-entity geometry="primitive:box; depth: 20; height:0.1; width: 30" position="0 10 0" material="color: yellow"></a-entity>

            <!--North Wall-->
            <a-entity geometry="primitive: box; depth: 0.2; height:10; width: 30" position="0 5 10" material="src: url(images/walls.jpg); repeat: 30 10"></a-entity>
            <!--East Wall-->
            <a-entity geometry="primitive: box; depth: 5; height:10; width: 0.2" position="15 5 -7.5" material="src: url(images/walls.jpg); repeat: 5 10"></a-entity>
            <a-entity geometry="primitive: box; depth: 15; height: 2.5; width: 0.2" position="15 8.75 2.5" material="src: url(images/walls.jpg); repeat: 15 2.5"></a-entity>
            <a-entity geometry="primitive: box; depth: 15; height: 7.5; width: 0.2" position="15 3.75 2.5" material="color: blue; opacity: 0.3; transparent: true; metalness: 1"></a-entity>
            <!--South Wall-->
            <a-entity geometry="primitive: box; depth: 0.2; height:10; width: 30" position="0 5 -10" material="src: url(images/walls.jpg); repeat: 30 10"></a-entity>

            <!-- Grass Outside-->
            <a-entity geometry="primitive: box; depth: 50; height: 0.05; width: 50" position="0 0 0" material="color: green"></a-entity>

            <a-entity position="0 1 -9" rotation="0 0 0">
                <a-gltf-model src="#tv" scale="0.2 0.2 0.2" shadow="cast: true"></a-gltf-model>
                <a-entity tv-screen class="intersectable" geometry="primitive: box; depth: 0.01; height: 1.4; width: 2.5" material="color: black" position="0 0.9 0.148"></a-entity>
            </a-entity>

            <a-entity position="6 0 -5" rotation="0 90 0">
                <a-gltf-model src="#sofa" scale="0.002 0.002 0.002"></a-gltf-model>
            </a-entity>

        </a-scene>
    </body>
</html>